<% layout('/layouts/boilerplate.ejs') -%>

    <body>

        <div class="row">
            <div class="col-8 offset-2">
                <h1>Listing Details</h1>
            </div>
            <div class="card show_card col-6 offset-2 mt-3 listing_card">
                <img src="<%= data[0].image %>" class="card-img-top show_img" alt="Loading...">
                <div class="card-body">
                    <h5 class="card-title">
                        <%= data[0].title %>
                    </h5>
                    <p class="card-text">
                        <%= data[0].description %> <br>
                            <b>Price:</b>
                            <%= data[0].price.toLocaleString("en-IN") %> <br>
                                <b>Location:</b>
                                <%= data[0].location %> <br>
                                    <b>Country:</b>
                                    <%= data[0].country %> <br>
                    </p>
                </div>
            </div>

        </div>
        <div class="btns">
            <form action="/listings/edit/<%= data[0]._id %>">
                <button class="btn btn-dark ">Edit</button>
            </form>
            <form action="/listings/<%= data[0]._id %>?_method=DELETE" method="post">
                <button id="delete_btn" class="btn btn-dark offset-10">Delete</button>
            </form>
        </div>
        <hr>
        <h2>Add Reviews</h2>
        <div class="mb-3 mt-4">
            <form action="/listings/reviews/<%= data[0]._id %>" method="post" class="needs-validation" novalidate>
                <div class="mb-3">
                    <label for="rating" class="form-label">Rating</label>
                    <input type="range" name="reviews[rating]" id="rating" class="form-range" min="1" max="5" required>
                </div>
                <div class="mb-3">
                    <label for="comment" class="form-label">Comment</label>
                    <textarea id="comment" name="reviews[comment]" class="form-control" required></textarea>
                </div>
                <div class="mb-3">
                    <button class="btn btn-primary">Submit</button>
                </div>
            </form>
        </div>
        <h4>All Reviews</h4>

        <div class="row">
            <% for( let index=0; index < data[0].reviews.length; index++ ) { %>
                <div class="card offset-1 mt-3" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title">Person Name</h5>
                        <h6 class="card-subtitle mb-2 text-body-secondary">
                            <%= data[0].reviews[index].comment %>
                        </h6>
                        <p class="card-text">
                            <% if (data[0].reviews[index].rating===5) { %>
                                <p>
                                    <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                        class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                        class="fa-solid fa-star"></i>
                                </p>
                                <% } else if (data[0].reviews[index].rating===4) { %>
                                    <p>
                                        <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                            class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                            class="fa-regular fa-star"></i>
                                    </p>
                                    <% } else if (data[0].reviews[index].rating===3) { %>
                                        <p>
                                            <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                                class="fa-solid fa-star"></i><i class="fa-regular fa-star"></i><i
                                                class="fa-regular fa-star"></i>
                                        </p>
                                        <% } else if (data[0].reviews[index].rating===2) { %>
                                            <p>
                                                <i class="fa-solid fa-star"></i><i class="fa-solid fa-star"></i><i
                                                    class="fa-regular fa-star"></i><i class="fa-regular fa-star"></i><i
                                                    class="fa-regular fa-star"></i>
                                            </p>
                                            <% } else if (data[0].reviews[index].rating===1) { %>
                                                <p>
                                                    <i class="fa-solid fa-star"></i><i class="fa-regular fa-star"></i><i
                                                        class="fa-regular fa-star"></i><i
                                                        class="fa-regular fa-star"></i><i
                                                        class="fa-regular fa-star"></i>
                                                </p>
                                                <% } %>

                        </p>
                    </div>
                    <form action="/listings/reviews/<%= data[0]._id %>/<%= data[0].reviews[index]._id %>?_method=DELETE" class="mb-3" method="post">
                        <button class="btn btn-danger" id="delete_reviews">Delete</button>
                    </form>
                </div>
                <% } %>
        </div>

        <script>
            let delete_btn = document.querySelector("#delete_btn");
            delete_btn.addEventListener("click", (e) => {
                if (!confirm("Are You Sure Want To Delete")) {
                    e.preventDefault();
                }
            });

            let delete_reviews=document.querySelector("#delete_reviews");
            delete_reviews.addEventListener("click",(e)=>{
                if(!confirm("Are You Sure Want To Delete This Review")){
                    e.preventDefault();
                }
            });
        </script>
    </body>